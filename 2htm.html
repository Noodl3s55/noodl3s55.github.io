<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>2htm</title>
    <meta name="description" content="Convert a file to html. Works with images, audios and videos">
</head>

<body>
  <h2 align="center">2htm</h2>
<input id="inp" type='file'> <br>
<a id="aa" href="" download="file.html"></a><br><br>
<button onclick="navigator.clipboard.writeText(etr)">Copy base64 output</button><br>
<input type="checkbox" id="cb" name="cb" onchange="sB64()"><label for="cb">Show base64 output (might lag or crash)</label><br>
<textarea autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" id="b64" style="background:#333;color:#fff;width:100%;height:60vh;border:2px solid #999;visibility:hidden" readonly></textarea>
<!--<select id="sel">
  <option value="i">Image</option>
  <option value="a">Audio</option>
  <option value="v">Video</option>
  <option value="t">Text</option>
</select>
--<img id="img" height="150">-->
<script>

const ta = document.getElementById("b64")
const aa = document.getElementById("aa")
const cb = document.getElementById("cb")
//const se = document.getElementById("sel")
var showB = false
var etr = ""

function sB64() {
  showB= !showB
  if(showB) {
    ta.style.visibility="visible"
  } else {
    ta.style.visibility="hidden"
  }
}

function readFile() {
    if (this.files && this.files[0]) {
        var FR = new FileReader();
        FR.addEventListener("load", function(e) {
          //document.getElementById("img").src = e.target.result;

          if(showB) {
        	  document.getElementById("b64").value = e.target.result;
          }
          etr = e.target.result
          let typeS; let mime= etr.slice(5, etr.indexOf(";"))
          let typeF;
          switch (etr.substr(5,2)) {
            case "im":
              typeS= "<img src='"+etr+"'>"
              typeF= "img"
              break
            case "au":
              typeS= "<audio controls><source src=\'"+etr+"\'type=\'"+mime+"\'></audio>"
              typeF= "aud"
              break
            case "vi":
              typeS="<video height=\'300px\' width=\'530px\' controls><source src=\'"+etr+"\'type=\'"+mime+"\'></video>"
              typeF= "vid"
              break
            case "te":
              typeF= "txt"
              alert("Conversion of text files not implemented yet")
              break
              default:
              alert("Not supported")
          }
          let name=typeF+Math.round(Math.random()*1000000)+".html"
          aa.download=name
          aa.innerHTML="Created file: "+name
          console.log(mime)
            aa.href= URL.createObjectURL(new Blob([typeS], {type: "text/html;charset=utf-8"}))
        });
        FR.readAsDataURL(this.files[0]);
    }
}
document.getElementById("inp").addEventListener("change", readFile);
//var d = "data:text/plain;base64,thisIsSomeData" //d.substr(5, d.length - 12) d.slice(5, d.indexOf(";"))
</script>
</body>
<style>
    body{
    background: #000;
    color:#fff;
    font-size:17px;
    margin: 15px;
  }
  input {
    font-size: 18px
  }
  button, select {
    width:150px;
    height:30px;
    color:#fff;
    background:#333;
    border: 2px solid #777;
    border-radius:10px;
  }
  a:link {
    color:#0af;
  }
  a:visited {
    color:#0fa;
  }
</style>
</html>